# Git 存储 (Stashing) 完全指南

## 什么是 Git 存储？

**Git 存储** 允许你将当前工作目录和暂存区的修改临时保存起来，让工作目录恢复到干净的状态，以便你可以切换分支、处理其他紧急任务，之后还能恢复这些修改。

## 核心命令

### 创建存储

bash

```
# 基本存储（只存储已跟踪文件的修改）
git stash

# 存储并包含未跟踪的文件
git stash -u

# 存储并包含所有文件（包括被忽略的文件）
git stash -a

# 存储时添加描述信息
git stash push -m "描述信息"
git stash push -u -m "LGL模板"

# 交互式存储（选择要存储的修改）
git stash -p
```



### 查看存储

bash

```
# 查看存储列表
git stash list

# 查看最新存储的详情
git stash show

# 查看指定存储的详情
git stash show stash@{1}

# 查看存储的详细差异
git stash show -p stash@{0}
```



### 恢复存储

bash

```
# 恢复最新的存储（不删除存储）
git stash apply

# 恢复指定的存储
git stash apply stash@{1}

# 恢复存储并保留暂存状态
git stash apply --index

# 恢复最新的存储并从列表中删除
git stash pop

# 恢复指定的存储并删除
git stash pop stash@{1}
```



### 删除存储

bash

```
# 删除最新的存储
git stash drop

# 删除指定的存储
git stash drop stash@{1}

# 清空所有存储
git stash clear
```



### 高级操作

bash

```
# 从存储创建新分支
git stash branch new-branch-name stash@{0}

# 将存储导出为补丁文件
git stash show -p stash@{0} > my_stash.patch
```



## 完整工作流示例

### 场景：临时切换分支修复紧急 bug

bash

```
# 1. 当前正在开发，有未提交的修改
$ git status
On branch feature-auth
Changes not staged for commit:
  modified:   src/login.js
  modified:   src/user.js
Untracked files:
  new file:   src/temp.js

# 2. 存储当前工作
$ git stash -u -m "开发登录功能中"
Saved working directory and index state On feature-auth: 开发登录功能中

# 3. 验证工作目录已干净
$ git status
On branch feature-auth
nothing to commit, working tree clean

# 4. 切换分支修复 bug
$ git checkout main
$ git checkout -b hotfix-critical-bug

# 5. 修复并提交 bug
# ... 修改代码 ...
$ git add .
$ git commit -m "修复紧急bug"

# 6. 回到原来的分支
$ git checkout feature-auth

# 7. 查看存储列表
$ git stash list
stash@{0}: On feature-auth: 开发登录功能中

# 8. 恢复存储
$ git stash pop

# 9. 继续开发...
```



### 场景：处理多个存储

bash

```
# 创建第一个存储
git stash -u -m "功能A开发中"

# 处理其他任务...
# 创建第二个存储
git stash -u -m "功能B实验"

# 查看所有存储
git stash list
# stash@{0}: On main: 功能B实验
# stash@{1}: On main: 功能A开发中

# 恢复特定的存储
git stash apply stash@{1}

# 完成后删除存储
git stash drop stash@{1}
```



## 最佳实践

### 1. 使用有意义的描述

bash

```
# 不好的做法
git stash

# 好的做法
git stash push -m "开发用户登录功能 - 正在进行密码加密"
```



### 2. 及时清理存储

定期检查并删除不再需要的存储：

bash

```
git stash list
git stash drop stash@{2}  # 删除旧的存储
```



### 3. 谨慎使用 `git stash pop`

如果不确定恢复是否成功，先使用 `apply`：

bash

```
git stash apply
# 检查一切正常后...
git stash drop
```



### 4. 处理冲突

恢复存储时可能产生冲突：

bash

```
git stash apply
# 如果发生冲突，手动解决...
# 解决后标记为已解决
git add .
# 然后删除存储
git stash drop
```



## 常见问题解答

### Q: 存储与提交有什么区别？

**存储**是临时的，不会创建提交历史，适合保存未完成的工作。
**提交**是永久的，会创建版本历史，适合保存完整的更改。

### Q: 存储的内容保存在哪里？

存储的内容保存在 Git 的引用目录中（`.git/refs/stash`），可以跨分支使用。

### Q: 存储会包含新文件吗？

默认不会，需要使用 `-u` 或 `-a` 参数来包含未跟踪的文件。

### Q: 存储有数量限制吗？

没有硬性限制，但建议及时清理不再需要的存储。

## 命令速查表

| 命令                  | 功能               |
| :-------------------- | :----------------- |
| `git stash`           | 创建存储           |
| `git stash -u`        | 存储包含未跟踪文件 |
| `git stash -m "描述"` | 带描述的存储       |
| `git stash list`      | 查看存储列表       |
| `git stash show`      | 查看存储详情       |
| `git stash apply`     | 恢复存储（不删除） |
| `git stash pop`       | 恢复并删除存储     |
| `git stash drop`      | 删除存储           |
| `git stash clear`     | 清空所有存储       |
| `git stash branch`    | 从存储创建分支     |

## 使用技巧

### 1. 部分存储

bash

```
# 只存储特定文件的修改
git stash push src/important-file.js

# 交互式选择要存储的修改
git stash -p
```



### 2. 检查存储内容

在恢复之前先查看存储内容：

bash

```
git stash show -p stash@{1}
```



### 3. 将存储应用到其他分支

bash

```
# 在当前分支创建存储
git stash -m "修改说明"

# 切换到其他分支
git checkout other-branch

# 恢复存储
git stash apply
```



------

**提示**：存储是 Git 中非常实用的功能，合理使用可以大大提高工作效率。记得定期清理不再需要的存储，保持存储列表的整洁！